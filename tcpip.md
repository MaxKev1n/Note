## 第一章

**Internet** —— 当前覆盖全球的因特网，指全球范围内由采用TCP/IP协议簇的众多计算机网相互连接而成的最大的开放式计算机网络，前身是阿帕网，是互联网的一个特例

**internet** —— 采用互联网技术互联起来的**互联网**

**IAB**：因特网体系结构委员会，Internet Architecture Board

* 建立因特网标准
* 管理RFC文档的发布
* 建立因特网的策略性研究计划

**IETF**：因特网工程任务组，Internet Engineering Task Force

**IRTF**：因特网研究任务组，Internet Research Task Force

**IESG**：因特网工程指导组，Internet Engineering Steering Group

**ISOC**：因特网协会，Internet Society

**InterNIC**：因特网网络信息中心，Internet Network Information Center

**CNNIC**：中国互联网络信息中心，China Internet Network Information Center

**ICANN**：Internet Corporation for Assigned Names and Numbers

**W3C**：World Wide Web Consortium

**RFC**：请求注解，Request For Comments

* 标准化轨迹的RFC
  * 提案标准
  * 草案标准
  * 因特网标准
* 非标准化轨迹的RFC
  * 实验性的RFC
  * 信息性的RFC
  * 历史性的RFC
* 其他状态的RFC
  * 最佳当前实现的RFC
  * 未知性的RFC



## 第二章

**计算机网络的分类**

按照拓扑结构：

* 总线型网（早期LAN）
* 星型网(LAN)
* 环型网(令牌环网，FDDI)
* 网状网(WAN主干)



按照覆盖范围：

* 广域网
* 城域网
* 局域网
* 个域网



**网络协议**(network protocol)：通信双方事先约定好和通信时必须遵守的规则的集合

* 语法：定义用户数据和控制信息的结构与格式
* 语义：解释控制信息每个部分的意义
* 同步规则（时序）：定义事件发生的详细顺序



**通信子网**：由通信设备和通信介质构成

**资源子网**：由计算机和其他终端系统构成

**OSI/RM**：开放系统互连参考模型

**以太网的分层**：物理层、数据链路层（LLC+MAC）



**X.25**

* 物理层
* 数据链路层
* 分组层

**ATM**：异步传输模式，Asynchronous Transfer Mode。传输单元为信元（cell），采用统计时分复用

**WWAN**：无线广域网，Wireless WAN

**WMAN**：无线城域网，Wireless MAN

**WLAN**：无线局域网，Wireless LAN

**Wi-Fi**：Wireless Fidelity，无线保真



**TCP/IP网络体系结构**：

* 应用层
* 传输层
* 网络层
* 网络接口层

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226214611664.png" alt="image-20211226214611664" style="zoom: 67%;" />



## 第三章

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226215500832.png" alt="image-20211226215500832" style="zoom:67%;" />



**A类地址**：最高位为0，剩下的7位的网络号中全0一般不用，全1(127)用作特殊的环回地址，所以只能表示$2^7-2$ =126个A类网络。24位主机号全0时表示本网络，全1时表示本网络的广播地址，所以，每个A类网络最多可以容纳$2^{24} -2$=16,777,214台主机

**B类地址**：最高2位为10，剩下的14位的网络号可以表示$2^{14}$=16384个B类网络。16位的主机号不能为全0和全1，所以，每个B类网络最多可以容纳$2^{16}-2$ = 65,534台主机

**C类地址**：最高3位为110，剩下的21位的网络号可以标识$2^{21}$ =2,097,152个C类网络。8位主机号不能为全0和全1，所以，每个C类网络最多可以容纳$2^8-2$= 254台主机

**D类地址**：最高4位为1110。组播地址，不能分配给设备的网络接口，只能作为信息的目的地址，表示信息的接收者是一组设备接口

**E类地址**：最高5位为11110。保留地址，可以用于实验目的



**网络地址**：因特网上的每个网络都有一个IP地址，其主机号全 “0”

**直接广播地址**：主机号全 “1”，向某个网络上的所有主机(包括计算机和路由器的)发送信息

**受限广播地址**：32比特全为“1” ，表示该信息发往本网络上的所有主机（设备接口）

**本网络地址**：网络号全为“0”，表示信息发给本网络的指定主机（设备接口）

**环回地址**：以127开头的IP地址，表示信息的接收者是本机，不会被网卡传到网络上去



**子网掩码**：本网络的网络号和子网号置1，主机号置0

**超网**：32个比特，超网号的比特置1，主机号的比特置0

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226222245612.png" alt="image-20211226222245612" style="zoom:50%;" />

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226222225657.png" alt="image-20211226222225657" style="zoom:50%;" />



**CIDR掩码**：32位，采用斜线表示法：W.X.Y.Z /n。斜线前是IP地址，n是掩码中连续“1”的个数，如11.126.60.41 /28



## 第四章

**ARP**：地址解析协议，Address Resolution Protocol，IP地址到物理地址

**RARP**：反向地址解析协议，Reverse ARP

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226233729833.png" alt="image-20211226233729833" style="zoom:50%;" />



* ARP和RARP请求帧以广播方式发送，此时帧的目的地址为广播地址 (以太网为48个1)

* 由于ARP和RARP报文较短（28个字节），在进行以太网帧的封装时还需增加18个字节的填充字段(PAD) 。以太网帧大小范围：64B-1518B



## 第五章

**IP协议**：提供无连接、不可靠的主机到主机的IP数据报(IP分组)传输服务

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211226235055914.png" alt="image-20211226235055914" style="zoom:50%;" />



* IP协议对**IP首部**进行**点到点**的校验 


## 第六章

**ICMP**：因特网控制报文协议，位于网络层，IP协议之上，所以ICMP报文使用IP数据报进行封装

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211228191644535.png" alt="image-20211228191644535" style="zoom:50%;" />

**ICMP报文**: 首部+数据。首部固定为8个字节

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211228191718040.png" alt="image-20211228191718040" style="zoom: 67%;" />



往返时延＝(t当前－t初始)－(t发送－t接收)

假设请求和应答传输时延相同，单程时延=往返时延/2

两设备时间差＝t接收－(t初始＋单程时延)，结果为正数，表示应答方的时间比请求方快

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211228205110913.png" alt="image-20211228205110913" style="zoom:67%;" />



* ICMP将上层请求转变为ICMP报文，然后使用IP数据报进行封装 (此时IP首部的协议字段为“1”)
* ICMP报文由ICMP的校验字段进行端到端的校验。而IP首部由IP的校验字段进行点到点的校验



## 第七章

**内部网关协议**

* 路由信息协议RIP (Routing Information Protocol)
* 开放最短路径优先OSPF (Open Shortest Path First)

**外部网关协议**

* 边界网关协议BGP (Border Gateway Protocol)



**水平分割法**：如果路由器从某个接口收到某些网络的VD信息，不允许再从此接口发出这些网络的信息

**毒性逆转法**：路由器从某个接口上收到某个网络的VD信息，可以从此接口发送此网络V-D信息，只是跳数要设为16

**保持法**：路由器在得知某直连网络不可达的一段时间内，禁止使用收到的V-D报文刷新此不可达信息



> 保持法RIP是应用层协议，RIP报文封装于UDP数据报中,RIP报文最大512字节，所以有最多25个V-D信息，否则需要增加报文数量

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211228214429299.png" alt="image-20211228214429299" style="zoom:50%;" />

> BGP协议位于应用层，使用TCP作为传输层协议

**直接传递**：在信宿网络中，直接传到信宿的过程

**间接传递**：在非信宿网络中的传递过程

## 第八章

**TCP**：传输控制协议，Transmission Control Protocol

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211228215857907.png" alt="image-20211228215857907" style="zoom:50%;" />

* 端到端校验
* 不仅校验整个TCP段(含端口信息)，还校验来自于IP首部的伪首部（包括双方IP地址、所用的协议、TCP段长度）



* 为了可靠建立连接，TCP设计了三次握手方式
* TCP采用四次握手来安全断开连接



TCP基于IP，为实现可靠传输服务，增加了

* 流量控制：进程把本方的接收窗口大小告知对方，要求对方发送窗口大小不超过这个值
* 拥塞控制：控制发送方的发送速率，使得网络来得及传输
  * 慢启动
  * 拥塞避免
  * 拥塞控制
    * 快速重传：发送方只要一连收到三个重复确认ACK就认为报文段丢失，并立即重传对方尚未收到ACK的报文段
    * 快速恢复：当在快速重传阶段收到连续三个重复的确认时，不执行慢启动算法，即拥塞窗口 cwnd 现在不设置为 1，而是设置为慢开始门限 ssthresh (减少后)的数值 --- 进入快速恢复
* 差错控制：
  * 段丢失。检测：发送方使用重传计时器。处理：超时重传。确认段的丢失不需处理，因为TCP采用累计确认
  * 段损坏。检测：接收方使用校验和字段。处理：丢弃出错的段，不返回确认段，由发送方超时重传
  * 段重复。一般由超时重传造成的。检测：接收方分析段序号。处理：直接丢弃重复段
  * 段失序。由于TCP基于IP，不能保证按序到达。处理：接收方对先到达的段暂不确认，放入接收缓存，直到前面的段都到齐了再一起向上提交并返回确认



## 第九章

**递归解析**：客户机请求所在区域的服务器解析，若不能给出结果，服务器将请求另一个服务器（通常是其父或子服务器）并等待响应，后续的服务器也是进行类似的处理。一直到找到能解析的服务器，然后原路返回解析结果

**反复解析**：客户机请求所在区域的域名服务器解析，若不能给出结果，则返回另一个服务器的IP地址，客户机再向第二个服务器发出解析请求，后续的服务器也是进行类似的处理，直到找到可以解析的服务器



## 第十章

**BOOTP**：BOOTstrap Protocol，位于应用层，基于UDP协议。使计算机获得上述四种网络参数，IP地址，所在网络的掩码，默认路由器的IP地址，默认DNS服务器的IP地址

动态主机配置协议DHCP是在TCP/IP网络上使客户机获得配置信息的协议，自动分配IP地址等网络参数，实现设备即插即用。IPv4, IPv6网络都可使用。服务器收到客户请求后，首先根据其物理地址检查静态数据库，如果没有查到，就从IP地址池中选择一个地址给客户，并协商该地址的租用期

> 客户机进程使用UDP 68端口在网络层中广播BOOTP请求

## 第十一章

**FTP**：文件传输协议，实现不同计算机之间可靠的文件传输。不同操作系统、不同字符集、不同文件结构和存储方式等。

FTP建立两条TCP连接，一条传送控制信息(命令和响应)，另一条传送文件数据

**控制连接的建立**：服务器控制进程在TCP 21端口侦听，客户机控制进程使用临时端口，向服务器控制进程发出连接请求

**数据连接的建立**：通常，FTP数据连接由服务器发起。客户机在已建立的控制连接上，使用PORT命令将其数据进程的临时端口号发给服务器。服务器数据进程在TCP 20端口，向客户机数据进程发出连接请求



## 第十三章

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211230090120710.png" alt="image-20211230090120710" style="zoom: 67%;" />

**UA**：User Agent，用户代理。用户与电子邮件系统的接口软件，实现与邮件服务器通信（使用SMTP将邮件发送至邮件服务器；使用POP3或IMAP从邮件服务器读取邮件）。如果使用网页收发邮件，则是使用HTTP协议访问邮件服务器，又称为Webmail

**SMTP**：简单邮件传输协议。应用层，基于TCP。

**MIME**：通用因特网邮件扩充，SMTP的补充，使得非ASCII信息也可以通过SMTP传送，如非英文字符，图片，附件等

**POP3**：邮局协议第3版本，应用层，基于TCP，服务器进程使用TCP 110端口

**IMAP**：Internet Mail Access Protocol，因特网邮件访问协议，基于TCP

> POP3中邮件由客户端管理，IMAP由服务器管理

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211230233422636.png" alt="image-20211230233422636" style="zoom:67%;" />



## 第十四章

**Telnet**：远程登录协议，工作在应用层，基于传输层的TCP，服务器进程使用TCP 23端口。提供远程登录功能，客户机将命令传送到服务器上执行，服务器返回执行结果

为了避免控制命令和用户数据不混淆，Telnet采用IAC转义控制字符(ASCII编码255)。IAC表示其后一个字符是控制命令，而不是用户数据

**选项协商**：用于双方协商工作模式，如是否采用全双工方式通信等。当一方要配置某个选项时，通过SEND命令发出请求，若对方同意，则选项起作用，否则保持原来的模式

Telnet的服务器进程和客户进程有**4种操作模式**：

* 半双工方式(默认模式)
* 一次一个字符方式
* 一次一行方式
* 行方式



## 第十五章

**HTTP**: HyperText Transfer Protocol，超文本传输协议，应用层，基于TCP，服务器进程默认使用TCP 80端口，也可指定使用临时端口。用于超文本文件的传输，也会使用MIME进行数据格式的转换

**URL**：Uniform Resource Locator，统一资源定位符，也称网址，是因特网资源的标准地址。

> **传输协议**://主机域名**(或IP地址) :** **端口号** **+** **路径**+**文件名**

URL中端口号和文件名都可以省略的



**HTTP的通信方式**：

* 点对点方式：客户机与服务器直接通信
* 中间服务器方式：通过中间服务器中转通信
* 缓存方式：客户机或中间服务器的缓存中，保存先前HTTP请求及应答的内容，当相同请求到来时直接应答

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211230091555158.png" alt="image-20211230091555158" style="zoom:67%;" />

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211230091640617.png" alt="image-20211230091640617" style="zoom:50%;" />



## 第十七章

**移动代理(Mobility Agent)**：移动代理分归属代理(Home Agent)和外地代理(Foreign Agent)两类，它们是服务器或路由器，能知道移动结点实际连接在何处

**移动IP地址**：移动IP节点拥有两个IP地址。归属地址(Home Address) 是移动结点与归属网连接时使用的地址。不管移动结点连至网络何处，其归属地址保持不变。转交地址(Care-of Address)是移动节点目前所在的外地网络临时分配给移动结点地址（如通过DHCP）。转交地址是移动结点与外地网络连接时使用的临时地址。每当移动结点接入到一个新的网络，转交地址就发生变化



> 要和远程主机通信，移动主机要经过三个阶段：代理发现、注册和数据传送



**代理发现(Agent Discovery)**：包括两个阶段：移动主机在离开它的归属网络前必须发现归属代理，即知道它的地址。移动主机在移动到外地网络后，还必须发现外地代理

移动IP定义了**两种**发现移动代理的方法：

* 被动发现：移动结点等待代理利用ICMP路由器通告报文周期性地广播代理通告报文
* 主动发现：当移动主机已经移动到新的网络而没有收到代理通告时，它可以使用ICMP询问报文主动发起代理询问

**注册(Registration)**：移动节点必须将其位置信息向其归属代理进行注册，以便被找到。注册报文用UDP进行封装，代理进程使用UDP 434端口，移动主机使用临时端口

**隧道技术(Tunneling)**：当移动结点在外地网络时，归属代理需要将远程主机传来的数据报转发给已注册的外地代理。此时，归属代理使用IP隧道技术，将原始IP数据包封装在转发的IP数据包中，转发到处于隧道终点的转交地址处

移动IP使用**三种**隧道技术：

* 用IP封装的IP
* 最小封装
* 通用路由封装



> 移动IP对通信对端和上层应用是透明的

移动IP的不足

* 三角路由带来的时延问题
* 隧道封装带来的开销问题
* QoS和集中处理问题

## 第二十一章

<img src="C:\Users\c1048\AppData\Roaming\Typora\typora-user-images\image-20211230093811758.png" alt="image-20211230093811758" style="zoom: 67%;" />



IPv6只在源节点进行数据报分片：源节点在发送数据报之前，检查传输路径，找出路径上所有网络的最小的MTU，然后源节点按此MTU进行分片。也可无需检查，源节点直接使用IPv6的最小MTU (1280字节)分片

十六进制数字的前导0可以去掉，如0042写成42；一连串的0可使用双冒号表示，但只能用一次。例如，地址0:0:0:42:0:0:0:A63C可以缩写成 ::42:0:0:0:A63C 或者 0:0:0:42::A63C，但不能写成 ::42::A63C

**IPv4向IPv6过渡**：

* 双协议栈
* 隧道技术



**IPv6的改进**：

* 更大的地址空间
* 简化的基本首部



## 总结

**网络层**：*ARP*(但在IP之下)、*IP*协议、*ICMP*(IP之上，使用IP封装)、*OSPF*(使用IP数据报封装)

**应用层**：*RIP*(封装于UDP)、*BGP*(使用TCP作为传输层协议)、*DNS*(基于TCP或UDP)，*BOOTP*(基于UDP)、*FTP*(基于TCP)、*SMTP*(基于TCP)、*POP3*(基于TCP)、*Telnet*(基于TCP)、*HTTP*(基于TCP)

**传输层**：*TCP*(基于IP)，*UDP*(基于IP)

> RARP使用链路层广播也能获取IP地址，但不能跨路由器

